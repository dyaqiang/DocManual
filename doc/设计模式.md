#### 1、单例模式

##### 1.1 What

单例模式，确保一个类只有一个实例，并且对外提供这个全局实例的访问入口。（一个类只容许一个对象存在）

##### 1.2 Why

防止消耗内存资源和系统资源，

##### 1.3 How

需要一个保存类的唯一实例的静态成员变量

构造函数、克隆函数 必须声明位私有的，防止外部程序创建或者复制实例

s提供一个访问这个实力的公共静态方法，返回唯一的实例引用

##### 1.4 Where / When

##### 1.5 Code(基本思想)

```php
class Singleton
{
    //私有属性。保护实例
    private static $instance = null;

    //构造方法私有化，防止外部创建实例
    private function __construct()
    {
    }

    //共有方法获取实例
    public static function getInstance()
    {
        //判断实例，有无创建，没有的话创建实例并返回，有直接返回
        if (!(self::$instance instanceof self)) {
            self::$instance = new self();
        }
        return self::$instance;
    }

    //克隆私有化，防止复制实例
    private function __clone()
    {
    }
}
```



```php
简单实现
class Db
{
    private static $_instance; //static可以保存值不丢失
    private static $_dbConnect;
    private        $_dbConfig = array(
        'host'     => '127.0.0.1',
        'user'     => 'root',
        'password' => '',
        'database' => 'yii2basic',
    );
    //使用private防止用户new
    private function __construct()
    {

    }

    //重写clone防止用户进行clone
    private function __clone()
    {
    }

    //由类的自身来进行实例化
    public static function getInstance()
    {
        if (!(self::$_instance instanceof self)) {
            self::$_instance = new self();
        }
        return self::$_instance;
    }

    //要做的具体事情
    public function connect()
    {
        self::$_dbConnect = @mysql_connect(
            $this->_dbConfig['host'],
            $this->_dbConfig['user'],
            $this->_dbConfig['password']);

        if (!self::$_dbConnect) {
            throw new Exception("mysql connect error" . mysql_error());
        }
        mysql_query("SET NAMES UTF8");
        mysql_select_db($this->_dbConfig['database'], self::$_dbConnect);
        return self::$_dbConnect;
    }
}

$a = Db::getInstance();
try {
    $a->connect();
} catch (Exception $e) {
    echo "sorry,error was happend." . $e->getMessage();
}

```

```php
trait的特性能力来引入
trait Singleton
{
    //私有属性。保护实例
    private static $instance = null;

    //构造方法私有化，防止外部创建实例
    private function __construct()
    {
    }

    //共有方法获取实例
    public static function getInstance()
    {
        //判断实例，有无创建，没有的话创建实例并返回，有直接返回
        if (!(self::$instance instanceof self)) {
            self::$instance = new self();
        }
        return self::$instance;
    }

    //克隆私有化，防止复制实例
    private function __clone()
    {
    }
}
class Db
{
    use Singleton;//trait引入
    private $_dbConfig = array(
        'host'     => '127.0.0.1',
        'user'     => 'root',
        'password' => '',
        'database' => 'test',
    );

    private static $_dbConnect;

  //本类要做的事
    public function getConnect()
    {
        self::$_dbConnect = @mysql_connect(
            $this->_dbConfig['host'],
            $this->_dbConfig['user'],
            $this->_dbConfig['password']);

        if (!self::$_dbConnect) {
            throw new Exception("mysql connect error" . mysql_error());
        }
        mysql_query("SET NAMES UTF-8");
        mysql_select_db($this->_dbConfig['database'], self::$_dbConnect);
        return self::$_dbConnect;
    }

}
$b = Db::getInstance();
$b->getConnect();
```









